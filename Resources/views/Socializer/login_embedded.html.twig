{% set apiKey = gigya_socializer.apiKey %}
{% set namespace = gigya_socializer.namespace %}
{% set loginFunctionName = gigya_socializer.loginFunctionName %}

<script type="text/javascript">
{% if namespace != 'window' %}
if ({{ namespace }} == null || typeof({{ namespace }}) != 'object') { var {{ namespace }} = window.{{ namespace }} = {}; }
{% endif %}

{{ loginFunctionName }} = function(provider, redirectURL, pendingRegistration, sessionExpiration, facebookExtraPermissions, authCodeOnly, callback, cid, context) {
    if (typeof gigya != 'undefined') {
        if (typeof console != 'undefined') console.log('Gigya:\n-- {{ loginFunctionName }} executed and source library already instantiated');

        var conf = {
            APIKey: '{{ apiKey }}'
        };

        var pendingRegistration = typeof(pendingRegistration) != 'undefined' ? pendingRegistration : false;        
        var sessionExpiration = typeof(sessionExpiration) != 'undefined' ? sessionExpiration : 0;
        var facebookExtraPermissions = typeof(facebookExtraPermissions) != 'undefined' ? facebookExtraPermissions : null;
        var authCodeOnly = typeof(authCodeOnly) != 'undefined' ? authCodeOnly : false;
        var callback = typeof(callback) != 'undefined' ? callback : null;
        var cid = typeof(cid) != 'undefined' ? cid : null;
        var context = typeof(context) != 'undefined' ? context : null;

        // Parameters for the showLoginUI method
        var params = {
            provider:  provider
            ,redirectURL: redirectURL
            ,pendingRegistration: pendingRegistration
            ,sessionExpiration: sessionExpiration
            ,facebookExtraPermissions: facebookExtraPermissions
            ,authCodeOnly: authCodeOnly
            ,callback: callback
            ,cid: cid
            ,context: context
        };
	
        // Show the "login" widget
        gigya.services.socialize.login(conf, params);
    } else {
        if (typeof console != 'undefined') console.log("Gigya:\n-- typeof gigya == "+typeof gigya+"\n-- Reattempting instantiation in 100 milliseconds");
        setTimeout(function(){
            {{ loginFunctionName }}();
        },100);
    }
}
</script>
