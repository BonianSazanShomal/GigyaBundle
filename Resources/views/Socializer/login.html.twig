{#
 # @param string containerID
 # @param int height
 # @param int weight
 # @param string onLoginHandler [optional]
 # @param string onLogoutHandler [optional]
 # @param string onLogoutParams [optional]
 # @param boolean showTermsLink [default == false]
 # @param boolean hideGigyaLink [default == true]
 # @param string buttonsStyle [default == 'fullLogo']
 # @param boolean showWhatsThis [default == true]
 # @param string cid [optional]
 # @param string library [default == 'jquery']
 #}

{% set apiKey = gigya_socializer.apiKey %}
{% set namespace = gigya_socializer.namespace %}
{% set loginFunctionName = gigya_socializer.loginFunctionName %}

<script type="text/javascript">
{% if namespace != 'window' %}
if ({{ namespace }} == null || typeof({{ namespace }}) != 'object') { var {{ namespace }} = window.{{ namespace }} = {}; }
{% endif %}

{{ loginFunctionName }} = function() {
    if (typeof gigya != 'undefined') {
        if (typeof console != 'undefined') console.log('Gigya already instantiated');

        var conf = {
            APIKey: '{{ apiKey }}'
        };

        // Parameters for the showLoginUI method
        var params = {
            containerID: '{{ containerID }}' // The container for the component
            ,height: {{ height | escape('js') }}
            ,width: {{ width | escape('js') }}
            {% if showTermsLink %}
            ,showTermsLink: {{ showTermsLink }}  // remove 'Terms' link
            {% else %}
            ,showTermsLink: false // remove 'Terms' link
            {% endif %}
            {% if hideGigyaLink %}
            ,hideGigyaLink: {{ hideGigyaLink }} // remove 'Gigya' link
            {% else %}
            ,hideGigyaLink: true // remove 'Gigya' link
            {% endif %}
            {% if not buttonsStyle %}
            ,buttonsStyle: 'fullLogo' // Change the default buttons design to "Full Logos" design  
            {% else %}
            ,buttonsStyle: '{{ buttonsStyle }}' // Change the default buttons design to "Full Logos" design  
            {% endif %}
            {% if showWhatsThis %}
            ,showWhatsThis: {{ showWhatsThis }} // Pop-up a hint describing the Login Plugin, when the user rolls over the Gigya link.
            {% else %}
            ,showWhatsThis: true // Pop-up a hint describing the Login Plugin, when the user rolls over the Gigya link.
            {% endif %}
            {% if cid %}
            ,cid: '{{ cid }}'
            {% else %}
            ,cid: ''
            {% endif %}
        };
	
        // Show the "login" widget
        gigya.services.socialize.showLoginUI(conf, params);
    } else {
        if (typeof console != 'undefined') console.log("Gigya:\n-- typeof gigya == "+typeof gigya+"\n-- Reattempting instantiation in 100 milliseconds");
        setTimeout(function(){
            {{ loginFunctionName }}();
        },100);
    }
}

{{ loginFunctionName }}();
</script>

{# TODO Support other javascript libraries #}
{% if library == 'jquery' %}
    {% include "GigyaBundle:Socializer:login_handlers_jquery.html.twig" with { 'onLoginHandler': onLoginHandler, 'onLogoutHandler': onLogoutHandler, 'onLogoutParams': onLogoutParams} %}
{% else %}
    {% include "GigyaBundle:Socializer:login_handlers_jquery.html.twig" with { 'onLoginHandler': onLoginHandler, 'onLogoutHandler': onLogoutHandler, 'onLogoutParams': onLogoutParams} %}
{% endif %}
